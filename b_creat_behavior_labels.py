import sys
import pandas as pd 
import datetime
import json

#* ---------------------------------------------------------------------------------------------
#*      For reading behavior csv and save into json 
#*     This json file is used  to be  a y part (y_train and y _test )of training data of ML model
#*       This json file will be like below,
#*       {malware family01:  {behavior01 : 1, behavior02 : 1, behavior03 : 1, behavior04 : 1}, 
#*        malware family02:  {behavior02 : 1, behavior03 : 1, behavior05 : 1, behavior06 : 1,},
#*        malware family03:  {behavior07 : 1, behavior08 : 1, behavior09 : 1, behavior10 : 1,}}
#* ----------------------------------------------------------------------------------------------------

def save_dict_result_in(saving_location,data_dict,name):
    time_stamp = datetime.datetime.now().strftime('%Y_%m_%d_%H')
    saving_location = saving_location.replace(" ","")

    if not saving_location.endswith('/'):    
        final_location = saving_location+'/'+'beha_'+name+time_stamp+'_dict.json'
    else:
        final_location = saving_location+'beha_'+name+time_stamp+'_dict.json'

    jsonfile = open(final_location, 'w+')
    print("Writting family dict into json.............")
    jsonfile.write(json.dumps(data_dict))
    jsonfile.close()
    print("Writting family dict into json.............Done")

    return final_location

def read_csv(file):
    data = open(file)
    df = pd.read_csv(data, index_col='Unnamed: 0')
    
    return df

if __name__ == "__main__":
    
    file = sys.argv[1]
    #! ./ex/behaviour_labels.csv

    location = sys.argv[2]
    #! ./
    
    name = "Final_project_test_"
    
    df = read_csv(file)
    dic_data = df.to_dict()

    print(dic_data)
    print( save_dict_result_in(location, dic_data, name) )

